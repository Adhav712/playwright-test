# Playwright POM with Allure Reporting

This project implements the Page Object Model (POM) pattern with data-driven testing and Allure reporting for Booking.com test automation.

## 📁 Project Structure

```
playwright-pom-allure/
├── package.json
├── tsconfig.json
├── playwright.config.ts
├── README.md
├── tests/
│   ├── e2e/
│   │   └── booking-search.spec.ts    # Data-driven E2E test
│   ├── data/
│   │   └── booking-search-data.json  # Test data
│   ├── pages/
│   │   ├── BookingHomePage.ts        # Home page POM
│   │   └── SearchResultsPage.ts      # Search results POM
│   └── kashifa_right.spec.ts         # Original test (preserved)
└── allure-results/                   # Generated by Allure
```

## 🚀 Features

- ✅ **Page Object Model (POM)** - Clean separation of concerns
- ✅ **Data-driven tests** - Tests driven by JSON data files
- ✅ **Allure reporting** - Rich HTML reports with steps and screenshots
- ✅ **TypeScript support** - Full type safety and IntelliSense
- ✅ **Multi-browser testing** - Chrome, Firefox, Safari support
- ✅ **Robust selectors** - Multiple fallback strategies for web elements

## 🛠️ Installation

```bash
# Install dependencies
pnpm install

# Install Playwright browsers
npx playwright install --with-deps
```

## 📋 Available Scripts

```bash
# Run all tests
npm run test

# Run tests in headed mode (visible browser)
npm run test:headed

# Run tests with Playwright UI
npm run test:ui

# Generate Allure report
npm run allure:generate

# Open Allure report
npm run allure:open

# Clean Allure artifacts
npm run allure:clean
```

## 🧪 Running Tests

### Run the new POM-based test:
```bash
npx playwright test tests/e2e/booking-search.spec.ts
```

### Run specific browser:
```bash
npx playwright test --project=chromium
npx playwright test --project=firefox
npx playwright test --project=webkit
```

### Run original test (preserved):
```bash
npx playwright test tests/kashifa_right.spec.ts
```

## 📊 Test Data

Test scenarios are defined in `tests/data/booking-search-data.json`:

```json
[
  {
    "title": "Mumbai hotel search and rating validation",
    "destination": "Mumbai",
    "checkInDate": "15",
    "checkOutDate": "16",
    "adults": 1,
    "children": 0,
    "rooms": 1,
    "expectedSortOrder": "rating_desc"
  }
]
```

You can add more test scenarios by extending this JSON file.

## 🏗️ Page Objects

### BookingHomePage.ts
- Handles navigation to Booking.com
- Manages destination search
- Handles date selection with calendar interactions
- Manages guest count adjustments
- Handles search submission
- Includes Google dialog dismissal logic

### SearchResultsPage.ts
- Manages search results page interactions
- Handles sorting by rating
- Extracts hotel prices and ratings
- Validates rating sort order
- Takes screenshots for verification

## 📈 Allure Reporting

After running tests, generate and view Allure reports:

```bash
npm run allure:generate
npm run allure:open
```

The reports include:
- Test step details with timing
- Screenshots on failure
- Browser console logs
- Network requests
- Test execution history

## 🔧 Configuration

### playwright.config.ts
- Configured for Booking.com base URL
- Allure reporter setup
- Multi-browser support
- Screenshot and video on failure
- Trace collection for debugging

### tsconfig.json
- ES2020 target with DOM support
- JSON module resolution enabled
- Strict TypeScript configuration

## 🎯 Test Features

The booking search test includes:

1. **Navigation** - Goes to Booking.com homepage
2. **Destination Search** - Searches for specified destination with autocomplete
3. **Date Selection** - Handles calendar interactions with fallback strategies
4. **Guest Management** - Adjusts adult/children count
5. **Search Execution** - Submits search and waits for results
6. **Result Sorting** - Attempts to sort by rating
7. **Data Extraction** - Gets hotel prices and ratings
8. **Validation** - Checks rating sort order
9. **Screenshots** - Captures final results for verification

## 🛡️ Robust Element Handling

The implementation includes multiple fallback strategies:
- Multiple selector patterns for elements
- Timeout handling with graceful degradation  
- Google dialog dismissal
- Calendar interaction fallbacks
- Screenshot capture on completion

## 📝 Adding New Tests

To add new test scenarios:

1. **Add test data** to `tests/data/booking-search-data.json`
2. **Extend page objects** in `tests/pages/` if needed
3. **Create new test file** in `tests/e2e/` using the POM pattern
4. **Run and iterate** until tests pass

Example test structure:
```typescript
import { test } from '@playwright/test';
import testData from '../data/your-data.json' assert { type: 'json' };
import { YourPageObject } from '../pages/YourPageObject';

test.describe('Your Test Suite', () => {
  for (const data of testData) {
    test(data.title, async ({ page }) => {
      const pageObject = new YourPageObject(page);
      
      await test.step('Step 1', async () => {
        // Your test logic
      });
    });
  }
});
```

## 🔍 Debugging

- Use `--headed` flag to see browser actions
- Use `--debug` flag to pause execution
- Check `allure-results/` for detailed logs
- Screenshots are saved for verification
- Console logs are captured in test output